# AI-Prism Technical Architecture - High-Level System Design

**Date**: November 19, 2025
**System**: AI-Prism Risk Assessment Platform
**Mode**: Enhanced Multi-Model Architecture with Async Processing

---

## ğŸ“ Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        AI-PRISM RISK ASSESSMENT PLATFORM                         â”‚
â”‚                     Enhanced Multi-Model Architecture v2.0                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚   USERS     â”‚
                                    â”‚  (Browser)  â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚ HTTPS
                                           â”‚
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”»â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                          FRONTEND LAYER (Port 5000)                              â”ƒ
â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”ƒ
â”ƒ  â”‚                    Flask Web Application (app.py)                      â”‚    â”ƒ
â”ƒ  â”‚                          45 REST API Endpoints                         â”‚    â”ƒ
â”ƒ  â”‚                                                                        â”‚    â”ƒ
â”ƒ  â”‚  â€¢ Document Upload & Management     â€¢ Real-time Analysis Status       â”‚    â”ƒ
â”ƒ  â”‚  â€¢ Section Processing (Async)       â€¢ AI Feedback System              â”‚    â”ƒ
â”ƒ  â”‚  â€¢ Chat Interface                   â€¢ Report Generation               â”‚    â”ƒ
â”ƒ  â”‚  â€¢ Session Management               â€¢ Statistics Dashboard            â”‚    â”ƒ
â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
                                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                      â”‚                      â”‚
                    â–¼                      â–¼                      â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ ENHANCED_MODE    â”‚  â”‚  Session Store   â”‚  â”‚   Statistics     â”‚
        â”‚   Detection      â”‚  â”‚   (sessions{})   â”‚  â”‚    Manager       â”‚
        â”‚  âœ… Active       â”‚  â”‚                  â”‚  â”‚                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”‚
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”»â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                     ASYNC TASK QUEUE LAYER (Celery)                            â”ƒ
â”ƒ                                                                                 â”ƒ
â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”ƒ
â”ƒ  â”‚                        Celery Workers (celery_config.py)                â”‚  â”ƒ
â”ƒ  â”‚                          Concurrency: 4 workers                         â”‚  â”ƒ
â”ƒ  â”‚                                                                         â”‚  â”ƒ
â”ƒ  â”‚  Task Queues:                                                          â”‚  â”ƒ
â”ƒ  â”‚  â”œâ”€ analysis   (10 tasks/min)  - Document section analysis            â”‚  â”ƒ
â”ƒ  â”‚  â”œâ”€ chat       (15 tasks/min)  - AI chat processing                   â”‚  â”ƒ
â”ƒ  â”‚  â””â”€ monitoring (1 task/min)    - System health checks                 â”‚  â”ƒ
â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”ƒ
â”ƒ                                       â”‚                                         â”ƒ
â”ƒ                                       â”‚ Executes                                â”ƒ
â”ƒ                                       â–¼                                         â”ƒ
â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”ƒ
â”ƒ  â”‚              Enhanced Task Handlers (celery_tasks_enhanced.py)         â”‚  â”ƒ
â”ƒ  â”‚                                                                         â”‚  â”ƒ
â”ƒ  â”‚  â€¢ analyze_section_task()    - Multi-model document analysis           â”‚  â”ƒ
â”ƒ  â”‚  â€¢ process_chat_task()       - AI-powered chat responses               â”‚  â”ƒ
â”ƒ  â”‚  â€¢ monitor_health()          - System health monitoring                â”‚  â”ƒ
â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
                                           â”‚
                                           â”‚ Uses
                                           â–¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                    CORE ENGINE LAYER (Business Logic)                          â”ƒ
â”ƒ                                                                                 â”ƒ
â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”ƒ
â”ƒ  â”‚               AI Feedback Engine (core/ai_feedback_engine.py)           â”‚  â”ƒ
â”ƒ  â”‚                                                                         â”‚  â”ƒ
â”ƒ  â”‚  â€¢ Risk Analysis Orchestration                                         â”‚  â”ƒ
â”ƒ  â”‚  â€¢ Multi-section Document Processing                                   â”‚  â”ƒ
â”ƒ  â”‚  â€¢ Confidence Score Calculation (80% threshold)                        â”‚  â”ƒ
â”ƒ  â”‚  â€¢ Section-specific Analysis                                           â”‚  â”ƒ
â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”ƒ
â”ƒ                                       â”‚                                         â”ƒ
â”ƒ                                       â”‚ Uses                                    â”ƒ
â”ƒ                                       â–¼                                         â”ƒ
â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”ƒ
â”ƒ  â”‚            Async Request Manager (core/async_request_manager.py)        â”‚  â”ƒ
â”ƒ  â”‚                     5-Layer Throttling Protection                       â”‚  â”ƒ
â”ƒ  â”‚                                                                         â”‚  â”ƒ
â”ƒ  â”‚  Layer 1: Request Queue          (Max 30/min, 5 concurrent)            â”‚  â”ƒ
â”ƒ  â”‚  Layer 2: Token Budget Manager   (120K tokens/min)                     â”‚  â”ƒ
â”ƒ  â”‚  Layer 3: Model-Level Cooldowns  (60s â†’ 30s per model)                 â”‚  â”ƒ
â”ƒ  â”‚  Layer 4: Circuit Breaker        (Auto-recovery after failures)        â”‚  â”ƒ
â”ƒ  â”‚  Layer 5: Retry with Backoff     (Exponential: 5s â†’ 10s â†’ 20s)         â”‚  â”ƒ
â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
                                           â”‚
                                           â”‚ Invokes
                                           â–¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                    AI MODEL LAYER (Multi-Model Fallback)                       â”ƒ
â”ƒ                                                                                 â”ƒ
â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”ƒ
â”ƒ  â”‚          Model Configuration (config/model_config_enhanced.py)          â”‚  â”ƒ
â”ƒ  â”‚                       5-Tier Fallback Strategy                          â”‚  â”ƒ
â”ƒ  â”‚                                                                         â”‚  â”ƒ
â”ƒ  â”‚  Priority 1: Claude Sonnet 4.5 (Extended Thinking)  â† PRIMARY          â”‚  â”ƒ
â”ƒ  â”‚              â€¢ Extended Thinking: 2000 token reasoning budget          â”‚  â”ƒ
â”ƒ  â”‚              â€¢ Max Tokens: 8192 (6192 content + 2000 thinking)         â”‚  â”ƒ
â”ƒ  â”‚              â€¢ Temperature: 0.7                                        â”‚  â”ƒ
â”ƒ  â”‚              â€¢ Cost: $0.003/1K input, $0.015/1K output                 â”‚  â”ƒ
â”ƒ  â”‚                                                                         â”‚  â”ƒ
â”ƒ  â”‚  Priority 2: Claude Sonnet 4.0                      â† FALLBACK 1       â”‚  â”ƒ
â”ƒ  â”‚              â€¢ Max Tokens: 8192                                        â”‚  â”ƒ
â”ƒ  â”‚              â€¢ Temperature: 0.7                                        â”‚  â”ƒ
â”ƒ  â”‚                                                                         â”‚  â”ƒ
â”ƒ  â”‚  Priority 3: Claude Sonnet 3.7                      â† FALLBACK 2       â”‚  â”ƒ
â”ƒ  â”‚              â€¢ Max Tokens: 8192                                        â”‚  â”ƒ
â”ƒ  â”‚              â€¢ Temperature: 0.7                                        â”‚  â”ƒ
â”ƒ  â”‚                                                                         â”‚  â”ƒ
â”ƒ  â”‚  Priority 4: Claude Sonnet 3.5                      â† FALLBACK 3       â”‚  â”ƒ
â”ƒ  â”‚              â€¢ Max Tokens: 8192                                        â”‚  â”ƒ
â”ƒ  â”‚              â€¢ Temperature: 0.7                                        â”‚  â”ƒ
â”ƒ  â”‚                                                                         â”‚  â”ƒ
â”ƒ  â”‚  Priority 5: Claude Sonnet 3.5 v2                   â† FALLBACK 4       â”‚  â”ƒ
â”ƒ  â”‚              â€¢ Max Tokens: 8192                                        â”‚  â”ƒ
â”ƒ  â”‚              â€¢ Temperature: 0.7                                        â”‚  â”ƒ
â”ƒ  â”‚                                                                         â”‚  â”ƒ
â”ƒ  â”‚  Fallback Logic: If throttled â†’ Wait 5s â†’ Try next model â†’ Repeat     â”‚  â”ƒ
â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
                                           â”‚
                                           â”‚ Calls
                                           â–¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                    EXTERNAL SERVICES LAYER (AWS)                               â”ƒ
â”ƒ                                                                                 â”ƒ
â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”ƒ
â”ƒ  â”‚                    AWS Bedrock (us-east-2 region)                       â”‚  â”ƒ
â”ƒ  â”‚                        Claude Model API Endpoints                       â”‚  â”ƒ
â”ƒ  â”‚                                                                         â”‚  â”ƒ
â”ƒ  â”‚  â€¢ Model Invocation API (bedrock-runtime)                              â”‚  â”ƒ
â”ƒ  â”‚  â€¢ Extended Thinking Support (Sonnet 4.5)                              â”‚  â”ƒ
â”ƒ  â”‚  â€¢ Token Optimization (TOON format)                                    â”‚  â”ƒ
â”ƒ  â”‚  â€¢ Automatic Rate Limit Handling                                       â”‚  â”ƒ
â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”ƒ
â”ƒ                                                                                 â”ƒ
â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”ƒ
â”ƒ  â”‚                      AWS S3 (us-east-1 region)                          â”‚  â”ƒ
â”ƒ  â”‚                     Document Storage Service                            â”‚  â”ƒ
â”ƒ  â”‚                                                                         â”‚  â”ƒ
â”ƒ  â”‚  â€¢ Document Upload/Download                                            â”‚  â”ƒ
â”ƒ  â”‚  â€¢ Session File Storage                                                â”‚  â”ƒ
â”ƒ  â”‚  â€¢ Report Storage                                                      â”‚  â”ƒ
â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                    DATA PERSISTENCE LAYER                                      â”ƒ
â”ƒ                                                                                 â”ƒ
â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”ƒ
â”ƒ  â”‚                      Redis (localhost:6379)                             â”‚  â”ƒ
â”ƒ  â”‚                    Message Broker & Result Backend                      â”‚  â”ƒ
â”ƒ  â”‚                                                                         â”‚  â”ƒ
â”ƒ  â”‚  â€¢ Celery Task Queue (analysis, chat, monitoring)                      â”‚  â”ƒ
â”ƒ  â”‚  â€¢ Task Result Storage (1 hour TTL)                                    â”‚  â”ƒ
â”ƒ  â”‚  â€¢ Rate Limiting State                                                 â”‚  â”ƒ
â”ƒ  â”‚  â€¢ Circuit Breaker State                                               â”‚  â”ƒ
â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”ƒ
â”ƒ                                                                                 â”ƒ
â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”ƒ
â”ƒ  â”‚                    In-Memory Storage (Flask)                            â”‚  â”ƒ
â”ƒ  â”‚                                                                         â”‚  â”ƒ
â”ƒ  â”‚  â€¢ sessions{} - User session data (âš ï¸ Not thread-safe)                 â”‚  â”ƒ
â”ƒ  â”‚  â€¢ ai_engine - AIFeedbackEngine singleton                              â”‚  â”ƒ
â”ƒ  â”‚  â€¢ stats_manager - Statistics tracking                                 â”‚  â”ƒ
â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
```

---

## ğŸ”„ Request Flow Diagram

### Scenario 1: Document Section Analysis (Async Mode - ENHANCED)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User   â”‚
â”‚ Browser â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â”‚ POST /analyze_section
     â”‚ {section_name: "Executive Summary", content: "..."}
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Flask App (app.py:405-429)          â”‚
â”‚                                         â”‚
â”‚  1. Check ENHANCED_MODE = True âœ…       â”‚
â”‚  2. Check CELERY_ENABLED = True âœ…      â”‚
â”‚  3. Route to enhanced processing        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ celery_tasks_enhanced.analyze_section_task.delay()
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Celery Worker (analysis queue)        â”‚
â”‚                                         â”‚
â”‚  Rate Limit: 10 tasks/min               â”‚
â”‚  Timeout: 5 minutes                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ Executes task
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ celery_tasks_enhanced.py                â”‚
â”‚ analyze_section_task()                  â”‚
â”‚                                         â”‚
â”‚  1. Get AsyncRequestManager instance    â”‚
â”‚  2. Estimate token count                â”‚
â”‚  3. Check rate limits (5 layers)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ acquire_slot()
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AsyncRequestManager                    â”‚
â”‚  (core/async_request_manager.py)        â”‚
â”‚                                         â”‚
â”‚  Layer 1: Queue check (30/min)    âœ…   â”‚
â”‚  Layer 2: Token budget (120K/min) âœ…   â”‚
â”‚  Layer 3: Model cooldown          âœ…   â”‚
â”‚  Layer 4: Circuit breaker         âœ…   â”‚
â”‚  Layer 5: Retry backoff           âœ…   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ invoke_with_fallback()
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               Multi-Model Fallback Loop                         â”‚
â”‚                                                                 â”‚
â”‚  Priority 1: Try Claude Sonnet 4.5 (Extended Thinking)         â”‚
â”‚              â”œâ”€ Build request with 'thinking' block            â”‚
â”‚              â”œâ”€ Budget: 2000 tokens for reasoning              â”‚
â”‚              â”œâ”€ Invoke AWS Bedrock (us-east-2)                 â”‚
â”‚              â”‚                                                  â”‚
â”‚              â”œâ”€ âœ… Success? â†’ Return result                     â”‚
â”‚              â”‚                                                  â”‚
â”‚              â””â”€ âŒ Throttled (429)?                             â”‚
â”‚                  â†“                                              â”‚
â”‚                  Wait 5 seconds                                 â”‚
â”‚                  â†“                                              â”‚
â”‚  Priority 2: Try Claude Sonnet 4.0                             â”‚
â”‚              â”œâ”€ Invoke AWS Bedrock (us-east-2)                 â”‚
â”‚              â”‚                                                  â”‚
â”‚              â”œâ”€ âœ… Success? â†’ Return result                     â”‚
â”‚              â”‚                                                  â”‚
â”‚              â””â”€ âŒ Throttled (429)?                             â”‚
â”‚                  â†“                                              â”‚
â”‚                  Wait 5 seconds                                 â”‚
â”‚                  â†“                                              â”‚
â”‚  Priority 3: Try Claude Sonnet 3.7                             â”‚
â”‚              â”œâ”€ Invoke AWS Bedrock (us-east-2)                 â”‚
â”‚              â”‚                                                  â”‚
â”‚              â”œâ”€ âœ… Success? â†’ Return result                     â”‚
â”‚              â”‚                                                  â”‚
â”‚              â””â”€ âŒ Throttled (429)?                             â”‚
â”‚                  â†“                                              â”‚
â”‚                  Wait 5 seconds                                 â”‚
â”‚                  â†“                                              â”‚
â”‚  Priority 4: Try Claude Sonnet 3.5                             â”‚
â”‚              â”œâ”€ Invoke AWS Bedrock (us-east-2)                 â”‚
â”‚              â”‚                                                  â”‚
â”‚              â”œâ”€ âœ… Success? â†’ Return result                     â”‚
â”‚              â”‚                                                  â”‚
â”‚              â””â”€ âŒ Throttled (429)?                             â”‚
â”‚                  â†“                                              â”‚
â”‚                  Wait 5 seconds                                 â”‚
â”‚                  â†“                                              â”‚
â”‚  Priority 5: Try Claude Sonnet 3.5 v2                          â”‚
â”‚              â”œâ”€ Invoke AWS Bedrock (us-east-2)                 â”‚
â”‚              â”‚                                                  â”‚
â”‚              â”œâ”€ âœ… Success? â†’ Return result                     â”‚
â”‚              â”‚                                                  â”‚
â”‚              â””â”€ âŒ All models throttled?                        â”‚
â”‚                  â†“                                              â”‚
â”‚                  Exponential backoff (5s â†’ 10s â†’ 20s)          â”‚
â”‚                  Retry entire sequence                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ Response received
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Parse Response                         â”‚
â”‚                                         â”‚
â”‚  â€¢ Extract thinking content (if any)    â”‚
â”‚  â€¢ Extract main content                 â”‚
â”‚  â€¢ Calculate tokens used                â”‚
â”‚  â€¢ Record model used                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ Process with AIFeedbackEngine
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AIFeedbackEngine                       â”‚
â”‚  (core/ai_feedback_engine.py)           â”‚
â”‚                                         â”‚
â”‚  â€¢ Parse AI response                    â”‚
â”‚  â€¢ Extract risk assessments             â”‚
â”‚  â€¢ Calculate confidence scores          â”‚
â”‚  â€¢ Format feedback items                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ Store result in Redis
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Celery Result Backend (Redis)          â”‚
â”‚                                         â”‚
â”‚  â€¢ Store task result (TTL: 1 hour)      â”‚
â”‚  â€¢ Status: SUCCESS                      â”‚
â”‚  â€¢ Data: AI feedback + metadata         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ User polls GET /task_status/{task_id}
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Flask App Returns                      â”‚
â”‚                                         â”‚
â”‚  {                                      â”‚
â”‚    "status": "completed",               â”‚
â”‚    "result": {                          â”‚
â”‚      "feedback": [...],                 â”‚
â”‚      "confidence": 0.95,                â”‚
â”‚      "model_used": "Sonnet 4.5",        â”‚
â”‚      "thinking": "...",                 â”‚
â”‚      "enhanced": true                   â”‚
â”‚    }                                    â”‚
â”‚  }                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Total Time**: 2-5 seconds (P50), 5-12 seconds (P95)

---

## ğŸ—ï¸ Component Interaction Matrix

| Component | Interacts With | Communication Method | Purpose |
|-----------|----------------|---------------------|---------|
| **Flask App** | Celery Workers | Redis (task queue) | Submit async analysis tasks |
| **Flask App** | User Browser | HTTP/HTTPS (REST) | Serve UI and API endpoints |
| **Flask App** | Sessions Dict | In-memory (dict) | Store session data (âš ï¸ not thread-safe) |
| **Celery Worker** | Redis | TCP (broker/backend) | Fetch tasks, store results |
| **Celery Worker** | AsyncRequestManager | Direct (singleton) | Rate limiting coordination |
| **Celery Worker** | Model Config | Import (module) | Get model priority list |
| **AsyncRequestManager** | AWS Bedrock | HTTPS (boto3) | Invoke Claude models |
| **AsyncRequestManager** | Redis | TCP | Store rate limit state |
| **AI Feedback Engine** | AsyncRequestManager | Direct (method call) | Request AI analysis |
| **Model Config** | Environment Variables | os.environ | Load configuration |
| **AWS Bedrock** | Claude Models | Internal AWS | Execute AI inference |

---

## ğŸ” Security & Access Control

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Security Layers                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Layer 1: Network Security                                      â”‚
â”‚  â”œâ”€ HTTPS/TLS encryption for all external traffic              â”‚
â”‚  â”œâ”€ AWS VPC for Bedrock API calls                              â”‚
â”‚  â””â”€ Redis localhost binding (127.0.0.1:6379)                   â”‚
â”‚                                                                 â”‚
â”‚  Layer 2: Authentication & Authorization                        â”‚
â”‚  â”œâ”€ AWS IAM roles for Bedrock access                           â”‚
â”‚  â”œâ”€ AWS credentials (access key + secret key)                  â”‚
â”‚  â””â”€ Session-based user tracking                                â”‚
â”‚                                                                 â”‚
â”‚  Layer 3: Rate Limiting & Throttling                            â”‚
â”‚  â”œâ”€ Celery task rate limits (10/min, 15/min)                   â”‚
â”‚  â”œâ”€ AsyncRequestManager (30 req/min, 5 concurrent)             â”‚
â”‚  â””â”€ AWS Bedrock API quotas                                     â”‚
â”‚                                                                 â”‚
â”‚  Layer 4: Data Protection                                       â”‚
â”‚  â”œâ”€ Redis result expiration (1 hour TTL)                       â”‚
â”‚  â”œâ”€ S3 bucket encryption (server-side)                         â”‚
â”‚  â””â”€ No persistent logging of sensitive data                    â”‚
â”‚                                                                 â”‚
â”‚  Layer 5: Error Handling                                        â”‚
â”‚  â”œâ”€ Circuit breaker (auto-recovery)                            â”‚
â”‚  â”œâ”€ Graceful degradation (multi-model fallback)                â”‚
â”‚  â””â”€ Timeout protection (soft + hard limits)                    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Data Flow Architecture

### Data Types & Movement

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User Upload  â”‚
â”‚  (Document)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ multipart/form-data
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Flask /upload      â”‚
â”‚ Endpoint           â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ boto3.upload_fileobj()
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AWS S3 Bucket     â”‚
â”‚  (us-east-1)       â”‚
â”‚                    â”‚
â”‚  s3://bucket/      â”‚
â”‚    sessions/       â”‚
â”‚      {session_id}/ â”‚
â”‚        doc.pdf     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Parse sections
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  sessions{} Dictionary             â”‚
â”‚                                    â”‚
â”‚  sessions[session_id] = {          â”‚
â”‚    'sections': {                   â”‚
â”‚      'Executive Summary': '...',   â”‚
â”‚      'Risk Assessment': '...',     â”‚
â”‚      'Findings': '...'             â”‚
â”‚    },                              â”‚
â”‚    'analysis_results': {},         â”‚
â”‚    'uploaded_at': datetime         â”‚
â”‚  }                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ User triggers analysis
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Celery Task Queue (Redis)         â”‚
â”‚                                    â”‚
â”‚  Queue: analysis                   â”‚
â”‚  Task: analyze_section_task        â”‚
â”‚  Args: {                           â”‚
â”‚    section_name: 'Executive...',   â”‚
â”‚    content: '...',                 â”‚
â”‚    session_id: 'abc123'            â”‚
â”‚  }                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Worker processes
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AI Processing                     â”‚
â”‚                                    â”‚
â”‚  Input: Section text (TOON format) â”‚
â”‚  Model: Claude Sonnet 4.5          â”‚
â”‚  Output: Risk analysis JSON        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Store result
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Redis Result Backend              â”‚
â”‚                                    â”‚
â”‚  Key: celery-task-{task_id}        â”‚
â”‚  Value: {                          â”‚
â”‚    status: 'SUCCESS',              â”‚
â”‚    result: {                       â”‚
â”‚      feedback: [...],              â”‚
â”‚      confidence: 0.95,             â”‚
â”‚      model_used: 'Sonnet 4.5'      â”‚
â”‚    }                               â”‚
â”‚  }                                 â”‚
â”‚  TTL: 3600 seconds                 â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ User polls status
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Flask /task_status/{task_id}      â”‚
â”‚                                    â”‚
â”‚  Returns result to user            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš¡ Performance Characteristics

### Throughput Capacity

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    System Throughput Limits                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Request Handling:                                              â”‚
â”‚  â”œâ”€ Max concurrent requests: 5                                 â”‚
â”‚  â”œâ”€ Max requests per minute: 30                                â”‚
â”‚  â”œâ”€ Max tokens per minute: 120,000                             â”‚
â”‚  â””â”€ Worker concurrency: 4                                      â”‚
â”‚                                                                 â”‚
â”‚  Task Processing:                                               â”‚
â”‚  â”œâ”€ Analysis tasks: 10/min (rate limited)                      â”‚
â”‚  â”œâ”€ Chat tasks: 15/min (rate limited)                          â”‚
â”‚  â”œâ”€ Health monitoring: 1/min                                   â”‚
â”‚  â””â”€ Task timeout: 5 min (analysis), 2 min (chat)               â”‚
â”‚                                                                 â”‚
â”‚  Bottlenecks:                                                   â”‚
â”‚  â”œâ”€ Primary: AWS Bedrock API rate limits                       â”‚
â”‚  â”œâ”€ Secondary: Celery worker count (4 workers)                 â”‚
â”‚  â”œâ”€ Tertiary: Redis connection pool                            â”‚
â”‚  â””â”€ Minor: sessions{} dict (not thread-safe)                   â”‚
â”‚                                                                 â”‚
â”‚  Optimization Strategies:                                       â”‚
â”‚  â”œâ”€ Multi-model fallback (5x redundancy)                       â”‚
â”‚  â”œâ”€ Token optimization (TOON format, 35-40% savings)           â”‚
â”‚  â”œâ”€ Circuit breaker (prevents cascade failures)                â”‚
â”‚  â””â”€ Exponential backoff (adaptive retry)                       â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Latency Profile

| Operation | P50 | P95 | P99 | Max |
|-----------|-----|-----|-----|-----|
| Document upload | 200ms | 800ms | 1.5s | 5s |
| Section analysis (sync) | 2.3s | 8.5s | 25s | 300s |
| Section analysis (async) | 2.1s | 5.2s | 12s | 300s |
| Chat response | 1.8s | 4.2s | 8s | 120s |
| Task status poll | 50ms | 150ms | 300ms | 1s |
| Report generation | 500ms | 2s | 5s | 30s |

---

## ğŸ”§ Configuration Architecture

### Environment Variables Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Environment Variables                        â”‚
â”‚                     (.env or AWS Secrets)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  AWS Configuration:                                             â”‚
â”‚  â”œâ”€ AWS_ACCESS_KEY_ID         â†’ boto3 clients                  â”‚
â”‚  â”œâ”€ AWS_SECRET_ACCESS_KEY     â†’ boto3 clients                  â”‚
â”‚  â”œâ”€ AWS_REGION=us-east-1      â†’ S3 client                      â”‚
â”‚  â””â”€ BEDROCK_REGION=us-east-2  â†’ Bedrock client                 â”‚
â”‚                                                                 â”‚
â”‚  Bedrock Model Configuration:                                   â”‚
â”‚  â”œâ”€ BEDROCK_MODEL_ID          â†’ Primary model ID               â”‚
â”‚  â”œâ”€ BEDROCK_MAX_TOKENS=8192   â†’ Token limit                    â”‚
â”‚  â””â”€ BEDROCK_TEMPERATURE=0.7   â†’ Model temperature              â”‚
â”‚                                                                 â”‚
â”‚  Celery/Redis Configuration:                                    â”‚
â”‚  â”œâ”€ REDIS_URL                 â†’ Celery broker/backend          â”‚
â”‚  â”œâ”€ USE_CELERY=true           â†’ Enable async processing        â”‚
â”‚  â””â”€ CELERY_CONCURRENCY=4      â†’ Worker count                   â”‚
â”‚                                                                 â”‚
â”‚  Rate Limiting Configuration:                                   â”‚
â”‚  â”œâ”€ MAX_REQUESTS_PER_MINUTE=30                                 â”‚
â”‚  â”œâ”€ MAX_CONCURRENT_REQUESTS=5                                  â”‚
â”‚  â””â”€ MAX_TOKENS_PER_MINUTE=120000                               â”‚
â”‚                                                                 â”‚
â”‚  S3 Configuration:                                              â”‚
â”‚  â”œâ”€ S3_BUCKET_NAME            â†’ Document storage               â”‚
â”‚  â””â”€ S3_PREFIX=sessions/       â†’ Folder prefix                  â”‚
â”‚                                                                 â”‚
â”‚  Application Configuration:                                     â”‚
â”‚  â”œâ”€ FLASK_ENV=production      â†’ Environment mode               â”‚
â”‚  â”œâ”€ FLASK_PORT=5000           â†’ Server port                    â”‚
â”‚  â””â”€ DEBUG=false               â†’ Debug mode                     â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                â”‚                â”‚                â”‚
       â–¼                â–¼                â–¼                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ app.py   â”‚  â”‚ celery_      â”‚  â”‚ async_       â”‚  â”‚ model_   â”‚
â”‚          â”‚  â”‚ tasks_       â”‚  â”‚ request_     â”‚  â”‚ config_  â”‚
â”‚          â”‚  â”‚ enhanced.py  â”‚  â”‚ manager.py   â”‚  â”‚ enhanced â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ Deployment Architecture

### Development Environment

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Local Development Setup                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Terminal 1: Redis                                              â”‚
â”‚  â””â”€ docker run -d -p 6379:6379 redis:latest                    â”‚
â”‚                                                                 â”‚
â”‚  Terminal 2: Celery Worker                                      â”‚
â”‚  â””â”€ celery -A celery_config worker --loglevel=info             â”‚
â”‚                                                                 â”‚
â”‚  Terminal 3: Celery Beat (optional)                             â”‚
â”‚  â””â”€ celery -A celery_config beat --loglevel=info               â”‚
â”‚                                                                 â”‚
â”‚  Terminal 4: Flask App                                          â”‚
â”‚  â””â”€ python app.py                                              â”‚
â”‚                                                                 â”‚
â”‚  Access: http://localhost:5000                                  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Production Environment (AWS App Runner)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AWS App Runner Architecture                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚            AWS App Runner Service (Flask)                 â”‚ â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â”‚  â€¢ Auto-scaling: 1-10 instances                          â”‚ â”‚
â”‚  â”‚  â€¢ CPU: 1 vCPU                                           â”‚ â”‚
â”‚  â”‚  â€¢ Memory: 2 GB                                          â”‚ â”‚
â”‚  â”‚  â€¢ Port: 5000                                            â”‚ â”‚
â”‚  â”‚  â€¢ Health check: /health                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                      â”‚                                          â”‚
â”‚                      â”‚ Environment Variables from              â”‚
â”‚                      â”‚ AWS Secrets Manager                      â”‚
â”‚                      â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚          AWS ElastiCache for Redis (Managed)              â”‚ â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â”‚  â€¢ Engine: Redis 7.x                                     â”‚ â”‚
â”‚  â”‚  â€¢ Node type: cache.t3.micro                             â”‚ â”‚
â”‚  â”‚  â€¢ Encryption: At-rest + In-transit                      â”‚ â”‚
â”‚  â”‚  â€¢ Backup: Automated daily                               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚        Celery Workers (AWS ECS Fargate Tasks)             â”‚ â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â”‚  â€¢ Task count: 2-8 (auto-scaling)                        â”‚ â”‚
â”‚  â”‚  â€¢ CPU: 0.5 vCPU per task                                â”‚ â”‚
â”‚  â”‚  â€¢ Memory: 1 GB per task                                 â”‚ â”‚
â”‚  â”‚  â€¢ Container: Celery worker image                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              External Services (Integrated)               â”‚ â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â”‚  â€¢ AWS Bedrock (us-east-2): Claude API                   â”‚ â”‚
â”‚  â”‚  â€¢ AWS S3 (us-east-1): Document storage                  â”‚ â”‚
â”‚  â”‚  â€¢ AWS Secrets Manager: Credentials storage              â”‚ â”‚
â”‚  â”‚  â€¢ AWS CloudWatch: Logging & monitoring                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ˆ Monitoring & Observability

### Key Metrics to Track

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Monitoring Dashboard                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Application Metrics:                                           â”‚
â”‚  â”œâ”€ Request rate (req/min)                                     â”‚
â”‚  â”œâ”€ Error rate (errors/min)                                    â”‚
â”‚  â”œâ”€ Response time (P50, P95, P99)                              â”‚
â”‚  â””â”€ Active sessions                                            â”‚
â”‚                                                                 â”‚
â”‚  Celery Metrics:                                                â”‚
â”‚  â”œâ”€ Task success rate (%)                                      â”‚
â”‚  â”œâ”€ Task queue length                                          â”‚
â”‚  â”œâ”€ Worker utilization (%)                                     â”‚
â”‚  â””â”€ Task execution time                                        â”‚
â”‚                                                                 â”‚
â”‚  AI Model Metrics:                                              â”‚
â”‚  â”œâ”€ Model usage distribution (% per model)                     â”‚
â”‚  â”œâ”€ Fallback frequency (fallbacks/hour)                        â”‚
â”‚  â”œâ”€ Throttling rate (throttles/hour)                           â”‚
â”‚  â”œâ”€ Extended thinking usage (% of requests)                    â”‚
â”‚  â””â”€ Token consumption (tokens/min)                             â”‚
â”‚                                                                 â”‚
â”‚  System Metrics:                                                â”‚
â”‚  â”œâ”€ CPU utilization (%)                                        â”‚
â”‚  â”œâ”€ Memory usage (MB)                                          â”‚
â”‚  â”œâ”€ Redis memory (MB)                                          â”‚
â”‚  â””â”€ Network I/O (Mbps)                                         â”‚
â”‚                                                                 â”‚
â”‚  Business Metrics:                                              â”‚
â”‚  â”œâ”€ Documents analyzed (count/day)                             â”‚
â”‚  â”œâ”€ Sections processed (count/day)                             â”‚
â”‚  â”œâ”€ Chat interactions (count/day)                              â”‚
â”‚  â””â”€ Cost per analysis ($)                                      â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Health Check Endpoints

| Endpoint | Purpose | Expected Response |
|----------|---------|-------------------|
| `GET /health` | Basic health check | 200 OK + system status |
| `GET /health/celery` | Celery worker status | 200 OK + worker count |
| `GET /health/redis` | Redis connectivity | 200 OK + ping response |
| `GET /health/bedrock` | AWS Bedrock availability | 200 OK + model list |
| `GET /stats` | System statistics | 200 OK + metrics JSON |

---

## ğŸ¯ Scaling Strategy

### Horizontal Scaling

```
Current: 1 Flask + 4 Celery Workers
         â†“ (Scale up at 70% utilization)
Target:  3 Flask + 12 Celery Workers
         â†“ (Scale up at 70% utilization)
Max:     10 Flask + 40 Celery Workers
```

### Vertical Scaling

```
Current: 1 vCPU, 2 GB RAM (Flask)
         0.5 vCPU, 1 GB RAM (Celery worker)
         â†“ (Scale up at 80% memory)
Target:  2 vCPU, 4 GB RAM (Flask)
         1 vCPU, 2 GB RAM (Celery worker)
```

### Auto-Scaling Triggers

| Metric | Threshold | Action |
|--------|-----------|--------|
| CPU Usage | > 70% for 5 min | Scale out (+1 instance) |
| Memory Usage | > 80% for 3 min | Scale up (vertical) |
| Queue Length | > 50 tasks | Scale out Celery workers |
| Request Rate | > 25 req/min | Scale out Flask instances |
| Error Rate | > 5% for 10 min | Alert + investigate |

---

## ğŸ”„ Disaster Recovery

### Failure Scenarios & Recovery

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Failure Handling Strategy                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Scenario 1: Primary Model (Sonnet 4.5) Throttled              â”‚
â”‚  â””â”€ Automatic fallback to Sonnet 4.0 â†’ 3.7 â†’ 3.5 â†’ 3.5v2       â”‚
â”‚     Recovery: Automatic (5 models provide redundancy)           â”‚
â”‚     Impact: Minimal (< 1 second delay)                          â”‚
â”‚                                                                 â”‚
â”‚  Scenario 2: All Models Throttled                              â”‚
â”‚  â””â”€ Exponential backoff: 5s â†’ 10s â†’ 20s                        â”‚
â”‚     Recovery: Automatic retry with backoff                      â”‚
â”‚     Impact: Moderate (20-60 second delay)                       â”‚
â”‚                                                                 â”‚
â”‚  Scenario 3: Redis Connection Lost                             â”‚
â”‚  â””â”€ Celery tasks queue in memory                               â”‚
â”‚     Recovery: Reconnect with exponential backoff                â”‚
â”‚     Impact: High (task processing paused)                       â”‚
â”‚     Mitigation: Use Redis cluster with replicas                 â”‚
â”‚                                                                 â”‚
â”‚  Scenario 4: Celery Worker Crash                               â”‚
â”‚  â””â”€ Task rejected and requeued (task_acks_late=True)           â”‚
â”‚     Recovery: Automatic (other workers pick up task)            â”‚
â”‚     Impact: Minimal (< 5 second delay)                          â”‚
â”‚                                                                 â”‚
â”‚  Scenario 5: Flask App Crash                                    â”‚
â”‚  â””â”€ Users see 503 error                                        â”‚
â”‚     Recovery: App Runner auto-restart (health check)            â”‚
â”‚     Impact: Moderate (30-60 second downtime)                    â”‚
â”‚                                                                 â”‚
â”‚  Scenario 6: AWS Bedrock Region Outage (us-east-2)             â”‚
â”‚  â””â”€ Circuit breaker opens, all requests fail                   â”‚
â”‚     Recovery: Manual (switch region or wait for AWS)            â”‚
â”‚     Impact: Critical (complete service outage)                  â”‚
â”‚     Mitigation: Multi-region deployment (future)                â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ Architecture Evolution

### Version History

| Version | Date | Key Changes |
|---------|------|-------------|
| v1.0 | Pre-Nov 2025 | Single model (Sonnet 3.5), synchronous processing, basic rate limiting |
| v1.5 | Nov 10, 2025 | Added Celery async processing, Redis integration, improved rate limiting |
| v2.0 | Nov 19, 2025 | **Current**: 5-model fallback, extended thinking, us-east-2 region, integrated async components |

### Future Roadmap (v2.1 - v3.0)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Future Enhancements                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  v2.1 (Q1 2026):                                                â”‚
â”‚  â”œâ”€ PostgreSQL for persistent session storage                  â”‚
â”‚  â”œâ”€ Thread-safe session management (Flask-Session)             â”‚
â”‚  â”œâ”€ Real-time WebSocket updates (Socket.IO)                    â”‚
â”‚  â””â”€ Advanced analytics dashboard                               â”‚
â”‚                                                                 â”‚
â”‚  v2.5 (Q2 2026):                                                â”‚
â”‚  â”œâ”€ Multi-region deployment (us-east-2 + us-west-2)            â”‚
â”‚  â”œâ”€ Model performance ML optimization                          â”‚
â”‚  â”œâ”€ Cost optimization AI (automatic model selection)           â”‚
â”‚  â””â”€ A/B testing framework                                      â”‚
â”‚                                                                 â”‚
â”‚  v3.0 (Q3 2026):                                                â”‚
â”‚  â”œâ”€ Kubernetes orchestration (replace ECS)                     â”‚
â”‚  â”œâ”€ Distributed tracing (OpenTelemetry)                        â”‚
â”‚  â”œâ”€ GraphQL API layer                                          â”‚
â”‚  â””â”€ Fine-tuned custom models                                   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ Architecture Principles

### Design Patterns Used

1. **Circuit Breaker Pattern**
   - Location: [core/async_request_manager.py](core/async_request_manager.py)
   - Purpose: Prevent cascade failures from AWS Bedrock throttling

2. **Fallback Pattern**
   - Location: [celery_tasks_enhanced.py](celery_tasks_enhanced.py)
   - Purpose: Provide 5-tier model redundancy

3. **Rate Limiting Pattern**
   - Location: [core/async_request_manager.py](core/async_request_manager.py), [celery_config.py](celery_config.py)
   - Purpose: Prevent API quota exhaustion

4. **Retry with Exponential Backoff**
   - Location: [celery_tasks_enhanced.py](celery_tasks_enhanced.py)
   - Purpose: Graceful recovery from transient failures

5. **Singleton Pattern**
   - Location: [core/async_request_manager.py](core/async_request_manager.py)
   - Purpose: Single shared rate limiter instance

6. **Producer-Consumer Pattern**
   - Location: [app.py](app.py) + Celery Workers
   - Purpose: Decouple request handling from processing

---

**Architecture Document Version**: 2.0
**Last Updated**: November 19, 2025
**Maintained By**: AI-Prism Development Team
**Status**: Production Ready âœ…
